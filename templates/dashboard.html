<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard ‚Ä¢ JobGuard AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root[data-theme="dark"] {
      --bg:#0f172a; --surface:#1e293b; --card:#0b1323; --accent:#3b82f6;
      --text:#f1f5f9; --muted:#94a3b8; --border:#475569; --hover:#1d4ed8;
      --fake:#dc2626; --real:#16a34a; --shadow:rgba(0,0,0,.45); --warning:#f59e0b;
    }
    :root[data-theme="light"] {
      --bg:#f8fafc; --surface:#ffffff; --card:#eef2ff; --accent:#2563eb;
      --text:#0f172a; --muted:#475569; --border:#e5e7eb; --hover:#1d4ed8;
      --fake:#dc2626; --real:#16a34a; --shadow:rgba(0,0,0,.12); --warning:#d97706;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:"Inter",system-ui,-apple-system,Segoe UI,sans-serif; background:var(--bg); color:var(--text); }

    /* Header */
    header { position:sticky; top:0; z-index:50; background:var(--surface); border-bottom:1px solid var(--border); box-shadow:0 3px 14px var(--shadow); backdrop-filter:blur(6px); }
    .nav { max-width:1440px; margin:0 auto; padding:20px 36px; display:flex; align-items:center; justify-content:space-between; }
    .brand { font-weight:800; color:var(--accent); font-size:22px; display:flex; align-items:center; gap:12px; text-decoration:none; }
    .brand .pulse { width:10px; height:10px; border-radius:50%; background:var(--accent); animation:pulse 2s infinite; }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(59,130,246,0.7);} 70%{box-shadow:0 0 0 12px rgba(59,130,246,0);} 100%{box-shadow:0 0 0 0 rgba(59,130,246,0);} }
    .nav-actions { display:flex; gap:12px; flex-wrap:wrap; }
    .btn { padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:var(--surface); color:var(--text); text-decoration:none; font-weight:700; font-size:14px; transition:all .12s ease; cursor:pointer; }
    .btn:hover { background:var(--card); transform:translateY(-1px); }
    .btn.primary { background:var(--accent); color:#fff; border-color:var(--hover); }
    .btn.primary:hover { filter:brightness(1.05); }
    .btn.danger { background:rgba(220,38,38,.15); color:var(--fake); border-color:rgba(220,38,38,.3); }
    .btn.danger:hover { background:rgba(220,38,38,.25); }

    /* Container */
    .container { max-width:1440px; margin:0 auto; padding:0 36px; }

    /* Page header */
    .page-header { padding:40px 0 20px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:20px; }
    .page-title { font-size:36px; font-weight:900; letter-spacing:.3px; }
    .header-actions { display:flex; gap:12px; flex-wrap:wrap; }

    /* Stats grid */
    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:20px; margin:32px 0; }
    .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:24px; box-shadow:0 8px 26px -6px var(--shadow); position:relative; overflow:hidden; }
    .stat-card::before { content:''; position:absolute; top:0; right:0; width:100px; height:100px; background:radial-gradient(circle, var(--accent) 0%, transparent 70%); opacity:.1; }
    .stat-label { color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.3px; }
    .stat-value { font-size:40px; font-weight:900; margin:8px 0; }
    .stat-change { color:var(--real); font-size:12px; font-weight:700; }
    .stat-change.negative { color:var(--fake); }
    .stat-icon { position:absolute; right:20px; top:20px; font-size:32px; opacity:.3; }

    /* Charts section */
    .charts-section { display:grid; grid-template-columns:repeat(auto-fit, minmax(350px,1fr)); gap:24px; margin:40px 0; }
    .chart-card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:24px; box-shadow:0 8px 26px -6px var(--shadow); }
    .chart-title { font-size:18px; font-weight:800; margin:0 0 20px; }
    .chart-container { position:relative; height:300px; }

    /* Retrain section */
    .retrain-section { background:linear-gradient(135deg, var(--accent) 0%, var(--hover) 100%); border-radius:16px; padding:32px; color:#fff; margin:40px 0; box-shadow:0 12px 40px -12px var(--shadow); }
    .retrain-title { font-size:24px; font-weight:900; margin:0 0 12px; }
    .retrain-subtitle { opacity:.9; margin-bottom:24px; }
    .retrain-form { display:grid; gap:16px; }
    .file-input-wrapper { position:relative; }
    .file-input-wrapper input[type="file"] { display:none; }
    .file-input-label { display:inline-flex; align-items:center; gap:10px; padding:12px 20px; background:rgba(255,255,255,.2); border:2px dashed rgba(255,255,255,.5); border-radius:12px; cursor:pointer; transition:.12s; font-weight:700; }
    .file-input-label:hover { background:rgba(255,255,255,.3); border-color:rgba(255,255,255,.8); }
    .retrain-btn { background:#fff; color:var(--accent); font-weight:800; padding:14px 28px; border:none; border-radius:12px; cursor:pointer; transition:all .12s ease; }
    .retrain-btn:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,.3); }

    /* Status messages */
    .status-msg { border-radius:12px; padding:16px; margin-top:16px; font-weight:700; display:none; }
    .status-msg.success { background:rgba(22,163,74,.15); color:var(--real); border:1px solid rgba(22,163,74,.3); }
    .status-msg.error { background:rgba(220,38,38,.15); color:var(--fake); border:1px solid rgba(220,38,38,.3); }
    .status-msg.show { display:block; animation:slideIn .24s ease; }
    @keyframes slideIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    /* Recent logs */
    .logs-section { margin:40px 0; }
    .logs-title { font-size:24px; font-weight:900; margin:0 0 20px; }
    .logs-container { background:var(--surface); border:1px solid var(--border); border-radius:16px; overflow:hidden; }
    .log-item { padding:16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
    .log-item:last-child { border-bottom:none; }
    .log-item:hover { background:var(--card); }
    .log-info { flex:1; }
    .log-date { color:var(--muted); font-size:12px; }
    .log-accuracy { font-weight:800; font-size:16px; }
    .log-source { color:var(--muted); font-size:13px; margin-top:4px; }
    .empty-logs { text-align:center; padding:40px 24px; color:var(--muted); }

    /* Model info */
    .model-info { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:20px; margin:40px 0; }
    .info-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:16px; }
    .info-item { }
    .info-label { color:var(--muted); font-size:12px; text-transform:uppercase; margin-bottom:8px; }
    .info-value { font-weight:800; font-size:16px; }

    /* Footer */
    footer { text-align:center; padding:48px 0 32px; color:var(--muted); border-top:1px solid var(--border); font-size:13px; }

    /* Spinner */
    .spinner { display:inline-block; width:16px; height:16px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .6s linear infinite; margin-left:8px; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* Responsive */
    @media (max-width:768px) {
      .page-header { flex-direction:column; align-items:flex-start; }
      .stats-grid { grid-template-columns:1fr 1fr; }
      .charts-section { grid-template-columns:1fr; }
      .retrain-section { padding:24px; }
      .log-item { flex-direction:column; align-items:flex-start; gap:12px; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav">
      <a href="{{ url_for('home') }}" class="brand"><span class="pulse"></span> JobGuard AI</a>
      <div class="nav-actions">
        <button class="btn" id="themeToggle" onclick="toggleTheme()">üåì</button>
        <a href="{{ url_for('home') }}" class="btn">Home</a>
        <a href="{{ url_for('history') }}" class="btn">History</a>
        <a href="{{ url_for('retrain_logs') }}" class="btn">üìã Logs</a>
        <a href="{{ url_for('logout') }}" class="btn danger">Logout</a>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <div class="container">
    <!-- Page header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">üìä Admin Dashboard</h1>
        <p style="color:var(--muted); margin-top:8px;">System overview & model management</p>
      </div>
      <div class="header-actions">
        <a href="{{ url_for('retrain_logs') }}" class="btn">View All Logs</a>
      </div>
    </div>

    <!-- Stats grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-label">Total Predictions</div>
        <div class="stat-value">{{ total }}</div>
        <div class="stat-change">+{{ total if total > 0 else 0 }} all-time</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üö©</div>
        <div class="stat-label">Fake Jobs Detected</div>
        <div class="stat-value" style="color:var(--fake);">{{ fake }}</div>
        <div class="stat-change negative">{{ "%.1f"|format((fake/total*100) if total > 0 else 0) }}% of total</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚úì</div>
        <div class="stat-label">Real Jobs Found</div>
        <div class="stat-value" style="color:var(--real);">{{ real }}</div>
        <div class="stat-change">{{ "%.1f"|format((real/total*100) if total > 0 else 0) }}% of total</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìà</div>
        <div class="stat-label">Model Accuracy</div>
        <div class="stat-value">{% if last_retrain %}{{ last_retrain[0] }}%{% else %}‚Äî{% endif %}</div>
        <div class="stat-change">{% if last_retrain %}Last: {{ last_retrain[1] }}{% else %}No training data{% endif %}</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="charts-section">
      <div class="chart-card">
        <div class="chart-title">üìà Daily Predictions</div>
        <div class="chart-container">
          <canvas id="predictionChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-title">üéØ Prediction Distribution</div>
        <div class="chart-container">
          <canvas id="distributionChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Retrain section -->
    <div class="retrain-section">
      <div class="retrain-title">üîÑ Retrain Model</div>
      <div class="retrain-subtitle">Upload a new dataset to improve model accuracy</div>
      <form id="retrainForm" class="retrain-form">
        <div class="file-input-wrapper">
          <input type="file" id="datasetFile" name="dataset" accept=".csv,.xlsx,.json">
          <label for="datasetFile" class="file-input-label">
            üìÅ Choose dataset or drag & drop
          </label>
          <small style="display:block; margin-top:8px; opacity:.8;">CSV, XLSX, or JSON files</small>
        </div>
        <button type="submit" class="retrain-btn">Start Retraining</button>
        <div id="retrainStatus" class="status-msg"></div>
      </form>
    </div>

    <!-- Model info -->
    <div class="model-info">
      <div style="font-weight:800; margin-bottom:16px;">‚ÑπÔ∏è Current Model Status</div>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Model Type</div>
          <div class="info-value">TF-IDF + Classifier</div>
        </div>
        <div class="info-item">
          <div class="info-label">Last Trained</div>
          <div class="info-value">{% if last_retrain %}{{ last_retrain[1] }}{% else %}Initial{% endif %}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Training Source</div>
          <div class="info-value">{% if last_retrain %}{{ last_retrain[2] }}{% else %}Default{% endif %}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Current Accuracy</div>
          <div class="info-value">{% if last_retrain %}{{ last_retrain[0] }}%{% else %}N/A{% endif %}</div>
        </div>
      </div>
    </div>

    <!-- Recent logs -->
    <div class="logs-section">
      <div class="logs-title">üìã Recent Training Logs</div>
      <div class="logs-container">
        {% if last_retrain %}
          <div class="log-item">
            <div class="log-info">
              <div style="font-weight:800;">Latest Training Session</div>
              <div class="log-date">{{ last_retrain[1] }}</div>
              <div class="log-source">Source: {{ last_retrain[2] }}</div>
            </div>
            <div class="log-accuracy" style="color:var(--real);">{{ last_retrain[0] }}%</div>
          </div>
          <div style="padding:16px; background:var(--card); border-radius:12px; margin-top:8px; font-size:13px; color:var(--muted);">
            ‚úì Model is up-to-date. Next retrain when accuracy needs improvement.
          </div>
        {% else %}
          <div class="empty-logs">
            <div style="font-size:32px; margin-bottom:8px;">üì≠</div>
            <div>No training logs yet</div>
            <div style="font-size:12px; margin-top:4px;">Upload a dataset and retrain to see logs here</div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <footer>¬© 2025 JobGuard AI ‚Ä¢ Admin Dashboard</footer>

  <script>
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      try { localStorage.setItem('jg-theme', next); } catch {}
    }
    (function() {
      try {
        const saved = localStorage.getItem('jg-theme');
        if (saved) document.documentElement.setAttribute('data-theme', saved);
      } catch {}
    })();

    // Chart.js setup
    const darkMode = document.documentElement.getAttribute('data-theme') === 'light' ? false : true;
    const chartBg = darkMode ? '#94a3b8' : '#475569';
    const chartAccent = '#3b82f6';
    const chartFake = '#dc2626';
    const chartReal = '#16a34a';

    // Daily predictions chart
    const predDates = {{ dates|tojson }};
    const predCounts = {{ counts|tojson }};
    new Chart(document.getElementById('predictionChart'), {
      type: 'line',
      data: {
        labels: predDates,
        datasets: [{
          label: 'Daily Predictions',
          data: predCounts,
          borderColor: chartAccent,
          backgroundColor: 'rgba(59,130,246,.1)',
          tension: .4,
          fill: true,
          pointRadius: 5,
          pointBackgroundColor: chartAccent,
          pointBorderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: { 
            beginAtZero: true,
            ticks: { color: chartBg },
            grid: { color: 'rgba(59,130,246,.1)' }
          },
          x: { ticks: { color: chartBg } }
        }
      }
    });

    // Distribution chart
    const fake = {{ fake }};
    const real = {{ real }};
    new Chart(document.getElementById('distributionChart'), {
      type: 'doughnut',
      data: {
        labels: ['Fake Jobs', 'Real Jobs'],
        datasets: [{
          data: [fake, real],
          backgroundColor: [chartFake, chartReal],
          borderColor: 'var(--surface)',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: chartBg, font: { weight: 700 } } }
        }
      }
    });

    // Retrain form
    document.getElementById('retrainForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      const file = document.getElementById('datasetFile').files[0];
      if (file) formData.append('dataset', file);

      const btn = e.target.querySelector('button');
      const origText = btn.textContent;
      btn.textContent = 'Retraining...';
      btn.disabled = true;

      try {
        const res = await fetch('{{ url_for("retrain") }}', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();

        const statusEl = document.getElementById('retrainStatus');
        if (data.success) {
          statusEl.className = 'status-msg success show';
          statusEl.textContent = `‚úì Retrain complete! New accuracy: ${data.accuracy}%`;
          document.getElementById('datasetFile').value = '';
          setTimeout(() => location.reload(), 2000);
        } else {
          statusEl.className = 'status-msg error show';
          statusEl.textContent = `‚ùå Error: ${data.error}`;
        }
      } catch (err) {
        document.getElementById('retrainStatus').className = 'status-msg error show';
        document.getElementById('retrainStatus').textContent = `‚ùå Error: ${err.message}`;
      } finally {
        btn.textContent = origText;
        btn.disabled = false;
      }
    });

    // Drag & drop
    const fileInput = document.getElementById('datasetFile');
    const label = document.querySelector('.file-input-label');
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
      label.addEventListener(e, (ev) => ev.preventDefault());
    });
    label.addEventListener('drop', (e) => {
      fileInput.files = e.dataTransfer.files;
    });
  </script>
</body>
</html>